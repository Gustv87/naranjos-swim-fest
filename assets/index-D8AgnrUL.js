const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Index-DvO-MiKk.js","assets/vendor-CXadzovC.js","assets/card-BMPkHib6.js","assets/radix-C1F2jKhp.js","assets/footer-BmELRPhz.js","assets/capacity-indicator-DcGO8zeW.js","assets/badge-DkEiIGtx.js","assets/firebase-DUZ5dv6p.js","assets/Inscripcion-BiXSsXIn.js","assets/label-DLWZ2p6X.js","assets/Reglamento-L2h4NHr0.js","assets/Admin-CjfW_WFg.js","assets/NotFound-BF2PeSss.js"])))=>i.map(i=>d[i]);
import{r as a,t as oe,m as re,j as s,X as se,n as ne,p as ie,$ as ae,Q as ce,q as le,B as de,w as ue,x as w,y as me}from"./vendor-CXadzovC.js";import{V as U,R as $,A as q,C as Q,T as X,D as G,P as pe,a as K,b as fe}from"./radix-C1F2jKhp.js";import{q as ge,o as he,c as B,a as xe,r as be,s as ye,u as ve,g as Se,b as M,d as we,e as N,f as Te,h as V,i as D}from"./firebase-DUZ5dv6p.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const Ae="modulepreload",je=function(t){return"/"+t},z={},j=function(e,o,n){let r=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),m=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));r=Promise.allSettled(o.map(f=>{if(f=je(f),f in z)return;z[f]=!0;const b=f.endsWith(".css"),E=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${E}`))return;const h=document.createElement("link");if(h.rel=b?"stylesheet":Ae,b||(h.as="script"),h.crossOrigin="",h.href=f,m&&h.setAttribute("nonce",m),document.head.appendChild(h),b)return new Promise((i,p)=>{h.addEventListener("load",i),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${f}`)))})}))}function c(l){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=l,window.dispatchEvent(m),!m.defaultPrevented)throw l}return r.then(l=>{for(const m of l||[])m.status==="rejected"&&c(m.reason);return e().catch(c)})},Ee=1,Ne=1e6;let O=0;function Ie(){return O=(O+1)%Number.MAX_SAFE_INTEGER,O.toString()}const P=new Map,F=t=>{if(P.has(t))return;const e=setTimeout(()=>{P.delete(t),A({type:"REMOVE_TOAST",toastId:t})},Ne);P.set(t,e)},Re=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,Ee)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(o=>o.id===e.toast.id?{...o,...e.toast}:o)};case"DISMISS_TOAST":{const{toastId:o}=e;return o?F(o):t.toasts.forEach(n=>{F(n.id)}),{...t,toasts:t.toasts.map(n=>n.id===o||o===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(o=>o.id!==e.toastId)}}},R=[];let _={toasts:[]};function A(t){_=Re(_,t),R.forEach(e=>{e(_)})}function _e({...t}){const e=Ie(),o=r=>A({type:"UPDATE_TOAST",toast:{...r,id:e}}),n=()=>A({type:"DISMISS_TOAST",toastId:e});return A({type:"ADD_TOAST",toast:{...t,id:e,open:!0,onOpenChange:r=>{r||n()}}}),{id:e,dismiss:n,update:o}}function De(){const[t,e]=a.useState(_);return a.useEffect(()=>(R.push(e),()=>{const o=R.indexOf(e);o>-1&&R.splice(o,1)}),[t]),{...t,toast:_e,dismiss:o=>A({type:"DISMISS_TOAST",toastId:o})}}function v(...t){return oe(re(t))}const Oe=pe,W=a.forwardRef(({className:t,...e},o)=>s.jsx(U,{ref:o,className:v("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...e}));W.displayName=U.displayName;const Pe=ne("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Y=a.forwardRef(({className:t,variant:e,...o},n)=>s.jsx($,{ref:n,className:v(Pe({variant:e}),t),...o}));Y.displayName=$.displayName;const Ce=a.forwardRef(({className:t,...e},o)=>s.jsx(q,{ref:o,className:v("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",t),...e}));Ce.displayName=q.displayName;const H=a.forwardRef(({className:t,...e},o)=>s.jsx(Q,{ref:o,className:v("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...e,children:s.jsx(se,{className:"h-4 w-4"})}));H.displayName=Q.displayName;const J=a.forwardRef(({className:t,...e},o)=>s.jsx(X,{ref:o,className:v("text-sm font-semibold",t),...e}));J.displayName=X.displayName;const Z=a.forwardRef(({className:t,...e},o)=>s.jsx(G,{ref:o,className:v("text-sm opacity-90",t),...e}));Z.displayName=G.displayName;function ke(){const{toasts:t}=De();return s.jsxs(Oe,{children:[t.map(function({id:e,title:o,description:n,action:r,...c}){return s.jsxs(Y,{...c,children:[s.jsxs("div",{className:"grid gap-1",children:[o&&s.jsx(J,{children:o}),n&&s.jsx(Z,{children:n})]}),r,s.jsx(H,{})]},e)}),s.jsx(W,{})]})}const Le=({...t})=>{const{theme:e="system"}=ie();return s.jsx(ae,{theme:e,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t})},Be=fe,Me=a.forwardRef(({className:t,sideOffset:e=4,...o},n)=>s.jsx(K,{ref:n,sideOffset:e,className:v("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...o}));Me.displayName=K.displayName;const Ve=a.lazy(()=>j(()=>import("./Index-DvO-MiKk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),ze=a.lazy(()=>j(()=>import("./Inscripcion-BiXSsXIn.js"),__vite__mapDeps([8,1,2,3,7,9,5]))),Fe=a.lazy(()=>j(()=>import("./Reglamento-L2h4NHr0.js"),__vite__mapDeps([10,1,2,3,6,7]))),Ue=a.lazy(()=>j(()=>import("./Admin-CjfW_WFg.js"),__vite__mapDeps([11,1,2,3,9,7]))),$e=a.lazy(()=>j(()=>import("./NotFound-BF2PeSss.js"),__vite__mapDeps([12,1,4]))),qe=new ce,Qe=()=>s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background text-sm text-muted-foreground",children:"Cargando contenido..."}),Xe=()=>s.jsx(le,{client:qe,children:s.jsxs(Be,{children:[s.jsx(ke,{}),s.jsx(Le,{}),s.jsx(a.Suspense,{fallback:s.jsx(Qe,{}),children:s.jsx(de,{basename:"/",children:s.jsxs(ue,{children:[s.jsx(w,{path:"/",element:s.jsx(Ve,{})}),s.jsx(w,{path:"/inscripcion",element:s.jsx(ze,{})}),s.jsx(w,{path:"/reglamento",element:s.jsx(Fe,{})}),s.jsx(w,{path:"/admin",element:s.jsx(Ue,{})}),s.jsx(w,{path:"*",element:s.jsx($e,{})})]})})})]})}),T=100,I="registrations",C=t=>String(t??"").replace(/\D/g,""),ee=a.createContext(void 0),Ge=(t,e)=>{const o=e.createdAt;let n=new Date().toISOString();if(typeof o=="string")n=o;else if(o&&typeof o=="object"&&"toDate"in o)try{n=o.toDate().toISOString()}catch(r){console.warn("Failed to parse createdAt timestamp",r)}return{id:t,createdAt:n,dorsal:String(e.dorsal??""),status:e.status??"pending",nombre:String(e.nombre??""),dni:(()=>{const r=C(e.dni);return r||String(e.dni??"")})(),nacimiento:String(e.nacimiento??""),email:String(e.email??""),telefono:String(e.telefono??""),club:String(e.club??""),distancia:String(e.distancia??""),sexo:String(e.sexo??""),categoria:String(e.categoria??""),emergenciaNombre:String(e.emergenciaNombre??""),emergenciaTel:String(e.emergenciaTel??""),medico:String(e.medico??""),banco:String(e.banco??""),monto:String(e.monto??""),referencia:String(e.referencia??""),tallaCamisa:String(e.tallaCamisa??""),comprobanteNombre:e.comprobanteNombre?String(e.comprobanteNombre):null,comprobanteUrl:e.comprobanteUrl?String(e.comprobanteUrl):null,comprobantePath:e.comprobantePath?String(e.comprobantePath):null,checkedInAt:(()=>{const r=e.checkedInAt;if(!r)return null;if(typeof r=="string")return r;if(typeof r=="object"&&"toDate"in r)try{return r.toDate().toISOString()}catch(c){return console.warn("Failed to parse checkedInAt timestamp",c),null}return null})(),checkedInBy:e.checkedInBy?String(e.checkedInBy):null}},Ke=t=>{if(!t.length)return"001";const e=t.map(n=>parseInt(n.dorsal,10)).filter(n=>Number.isFinite(n)).sort((n,r)=>r-n)[0]??0,o=Math.min(e+1,T);return String(o).padStart(3,"0")},We=({children:t})=>{const[e,o]=a.useState([]),[n,r]=a.useState(!0),[c,l]=a.useState(null);a.useEffect(()=>{const i=ge(B(N,I),he("createdAt","desc")),p=xe(i,g=>{const d=g.docs.map(x=>Ge(x.id,x.data()));d.sort((x,y)=>new Date(y.createdAt).getTime()-new Date(x.createdAt).getTime()),o(d),r(!1),l(null)},g=>{console.error("Error al obtener inscripciones",g),l("No se pudieron cargar las inscripciones."),r(!1)});return()=>p()},[]);const m=a.useCallback(async i=>{if(e.length>=T)throw new Error("No hay cupos disponibles");const p=Ke(e),g=Date.now();let d=null,x=null,y=null,u;try{i.comprobanteFile&&(y=i.comprobanteFile.name,d=`comprobantes/${p}-${g}-${y}`,u=be(ye,d),await ve(u,i.comprobanteFile),x=await Se(u));const S=C(i.dni);if(!S)throw new Error("DNI inválido");if(e.some(te=>C(te.dni)===S))throw new Error("DNI ya registrado");const L={nombre:i.nombre,dni:S,nacimiento:i.nacimiento,email:i.email,telefono:i.telefono,club:i.club,distancia:i.distancia,sexo:i.sexo,categoria:i.categoria,emergenciaNombre:i.emergenciaNombre,emergenciaTel:i.emergenciaTel,medico:i.medico,banco:i.banco,monto:i.monto,referencia:i.referencia,tallaCamisa:i.tallaCamisa,comprobanteNombre:y,comprobanteUrl:x,comprobantePath:d,checkedInAt:null,checkedInBy:null,dorsal:p,status:"pending",createdAt:M()};return{id:(await we(B(N,I),L)).id,...L,createdAt:new Date().toISOString()}}catch(S){if(u)try{await Te(u)}catch(k){console.warn("No se pudo limpiar el comprobante subido",k)}throw S}},[e]),f=a.useCallback(async(i,p,g={})=>{const d=V(N,I,i);await D(d,{status:p,...g})},[]),b=a.useCallback(async(i,p,g)=>{const d=V(N,I,i);p?await D(d,{checkedInAt:M(),checkedInBy:g}):await D(d,{checkedInAt:null,checkedInBy:null})},[]),E=a.useMemo(()=>{const i=e.length,p=e.filter(u=>u.status==="pending").length,g=e.filter(u=>u.status==="validated").length,d=e.filter(u=>u.status==="rejected").length,x=e.filter(u=>u.checkedInAt!==null).length,y=Math.max(T-i,0);return{total:i,pending:p,validated:g,rejected:d,remaining:y,max:T,capacityFull:i>=T,checkedIn:x}},[e]),h=a.useMemo(()=>({registrations:e,stats:E,isLoading:n,error:c,addRegistration:m,updateRegistrationStatus:f,toggleCheckIn:b}),[e,E,n,c,m,f,b]);return s.jsx(ee.Provider,{value:h,children:t})},et=()=>{const t=a.useContext(ee);if(!t)throw new Error("useRegistrations debe usarse dentro de RegistrationProvider");return t};me(document.getElementById("root")).render(s.jsx(We,{children:s.jsx(Xe,{})}));export{De as a,v as c,et as u};
