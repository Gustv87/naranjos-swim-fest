import{r as l,j as e,S as je,P as ge,N as Ne,T as ve,U as pe,V as fe,O as be,z as ye,W as we}from"./vendor-BSf5XApu.js";import{N as D,C as i,a as m,b as x,c as u,d as z,B as o}from"./card-B_2yIsY5.js";import{L as g,I as S}from"./label-DRkKdC70.js";import{a as Ce,u as ke}from"./index-D5TUlcfZ.js";import{k as Se,m as Ee,n as E,F as Ie,p as G}from"./firebase-DtyALkpc.js";import"./radix-CKG2RIUU.js";const Fe=()=>{const Q=["NT","NS","DNS","DNF"],{toast:r}=Ce(),{registrations:b,stats:j,updateRegistrationStatus:W,toggleCheckIn:K,updateRegistrationResult:X,isLoading:Y,error:F}=ke(),I=l.useMemo(()=>"gustavomartinezh87@gmail.com,admin@losnaranjos.com".split(",").map(s=>s.trim().toLowerCase()).filter(Boolean),[]),B="".trim(),[N,P]=l.useState({email:"",password:""}),[V,A]=l.useState(null),[v,p]=l.useState(null),[f,y]=l.useState(null),[Z,U]=l.useState(!0),[$,O]=l.useState(!1),[R,ee]=l.useState(""),[w,se]=l.useState(""),[C,ae]=l.useState(""),[k,te]=l.useState(""),[T,q]=l.useState({}),[ne,M]=l.useState({}),re=async s=>{s.preventDefault(),O(!0),A(null);try{const a=N.email.trim().toLowerCase();if(!I.includes(a))throw new Error("Este correo no está autorizado para acceder al panel.");if(B&&N.password===B){p(null),y({email:a}),U(!1),r({title:"Acceso autorizado",description:"Sesión iniciada en modo local"});return}await Ee(E,a,N.password),r({title:"Acceso autorizado",description:"Bienvenido al panel de administración"})}catch(a){let t="No se pudo autenticar. Intenta nuevamente.";if(a instanceof Ie)switch(a.code){case"auth/invalid-credential":case"auth/wrong-password":t="Contraseña incorrecta.";break;case"auth/user-not-found":t="No existe un usuario con ese correo.";break;case"auth/too-many-requests":t="Demasiados intentos. Espera unos minutos antes de volver a intentar.";break;default:t=a.message}else a instanceof Error&&(t=a.message);A(t),r({variant:"destructive",title:"Error",description:t})}finally{O(!1)}};l.useEffect(()=>{const s=Se(E,async a=>{var t;if(A(null),a){const c=((t=a.email)==null?void 0:t.toLowerCase())??"";I.includes(c)?(p(a),y(null)):(await G(E),p(null),y(null),r({variant:"destructive",title:"Acceso denegado",description:"Tu cuenta no tiene permiso para acceder al panel de administración."}))}else p(null);U(!1)});return()=>s()},[I,r]);const H=(v==null?void 0:v.email)??(f==null?void 0:f.email)??"",le=async()=>{try{v&&await G(E),y(null),p(null),r({title:"Sesión cerrada",description:"Has salido del panel de administración."})}catch{r({variant:"destructive",title:"Error",description:"No se pudo cerrar la sesión. Intenta nuevamente."})}},J=l.useMemo(()=>{const s=R.trim().toLowerCase();return b.filter(a=>{const t=!s||[a.nombre,a.dni,a.email,a.telefono,a.referencia,a.dorsal].map(n=>String(n||"").toLowerCase()).some(n=>n.includes(s)),c=!w||a.status===w,d=!C||a.distancia===C,h=!k||a.categoria===k;return t&&c&&d&&h}).sort((a,t)=>new Date(t.createdAt).getTime()-new Date(a.createdAt).getTime())},[b,R,w,C,k]),_=s=>{const a=new Date(s);return Number.isNaN(a.getTime())?s:a.toLocaleString("es-HN",{dateStyle:"medium",timeStyle:"short"})},ce=s=>s.id in T?T[s.id]:s.resultTime??"",de=(s,a)=>{q(t=>({...t,[s]:a}))},oe=async s=>{const t=(T[s.id]??s.resultTime??"").trim(),c=t?Q.includes(t.toUpperCase())?t.toUpperCase():t:"";M(d=>({...d,[s.id]:!0}));try{await X(s.id,c||null,H||"admin"),q(d=>({...d,[s.id]:c})),r({title:"Resultado actualizado",description:c?`Tiempo guardado: ${c}`:"Resultado eliminado"})}catch(d){const h=d instanceof Error?d.message:"No se pudo guardar el resultado.";r({variant:"destructive",title:"Error al guardar",description:h})}finally{M(d=>({...d,[s.id]:!1}))}},L=async(s,a)=>{const t={validated:{title:"Inscripción validada",description:"El participante aparece ahora como validado en el panel."},rejected:{title:"Inscripción rechazada",description:"Recuerda comunicar al participante el motivo del rechazo."},pending:{title:"Inscripción pendiente",description:"El registro volvió al estado pendiente para revisión."}};try{await W(s,a,a==="pending"?{checkedInAt:null,checkedInBy:null}:{}),r(t[a])}catch(c){console.error("Error al actualizar estado",c),r({variant:"destructive",title:"Error",description:"No se pudo actualizar el estado. Intenta nuevamente."})}},ie=s=>{r({title:s.nombre,description:`DNI: ${s.dni} | Email: ${s.email} | Tel: ${s.telefono||"No indicado"} | Talla: ${s.tallaCamisa||"No indicada"} | Comprobante: ${s.comprobanteNombre??"No adjuntado"}`})},me=s=>{if(!s.comprobanteUrl){r({variant:"destructive",title:"Sin comprobante",description:"Este registro no tiene un comprobante adjunto."});return}window.open(s.comprobanteUrl,"_blank","noopener,noreferrer")},xe=async s=>{try{const a=!s.checkedInAt;await K(s.id,a,H||"admin@losnaranjos.com"),r({title:a?"Check-in registrado":"Check-in revertido",description:a?`El participante ${s.nombre} quedó marcado como presente.`:`El check-in de ${s.nombre} fue revertido.`})}catch(a){console.error("Error al registrar check-in",a),r({variant:"destructive",title:"Error",description:"No se pudo registrar el check-in. Intenta nuevamente."})}},he=()=>{if(!b.length){r({title:"Sin datos",description:"Aún no hay inscripciones para exportar."});return}const s=["Dorsal","Nombre","DNI","Email","Teléfono","Distancia","Categoría","Talla","Banco","Monto","Referencia","Estado","Check-in","Check-in por","Fecha registro","URL comprobante"],a=b.map(n=>[n.dorsal,n.nombre,n.dni,n.email,n.telefono,n.distancia,n.categoria,n.tallaCamisa,n.banco,n.monto,n.referencia,n.status,n.checkedInAt?n.checkedInAt:"",n.checkedInBy??"",n.createdAt,n.comprobanteUrl??""]),t=[s,...a].map(n=>n.map(ue=>`"${String(ue??"").replace(/"/g,'""')}"`).join(",")).join(`
`),c=new Blob([t],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(c),h=document.createElement("a");h.href=d,h.download=`inscripciones-${new Date().toISOString()}.csv`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(d),r({title:"Exportación lista",description:"El archivo CSV se descargó correctamente."})};return Z&&!f?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(D,{}),e.jsx("div",{className:"flex items-center justify-center px-4 py-32",children:e.jsx(i,{className:"card-gradient shadow-card max-w-sm w-full",children:e.jsxs(m,{className:"text-center",children:[e.jsx(x,{className:"text-xl",children:"Cargando autenticación..."}),e.jsx(u,{children:"Por favor espera un momento."})]})})})]}):!v&&!f?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(D,{}),e.jsx("div",{className:"max-w-md mx-auto px-4 py-16",children:e.jsxs(i,{className:"card-gradient shadow-card",children:[e.jsxs(m,{className:"text-center",children:[e.jsx(je,{className:"h-16 w-16 text-primary mx-auto mb-4"}),e.jsx(x,{className:"text-2xl",children:"Acceso Restringido"}),e.jsx(u,{children:"Panel de administración del Encuentro de Aguas Abiertas Los Naranjos"})]}),e.jsxs(z,{children:[e.jsxs("form",{onSubmit:re,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"email",children:"Email"}),e.jsx(S,{id:"email",type:"email",value:N.email,onChange:s=>P(a=>({...a,email:s.target.value})),required:!0,placeholder:"admin@losnaranjos.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"password",children:"Contraseña"}),e.jsx(S,{id:"password",type:"password",value:N.password,onChange:s=>P(a=>({...a,password:s.target.value})),required:!0,placeholder:"••••••••"})]}),e.jsx(o,{type:"submit",className:"w-full button-gradient shadow-button",disabled:$,children:$?e.jsx(e.Fragment,{children:"Verificando..."}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Iniciar Sesión"]})}),V&&e.jsx("p",{className:"text-sm text-destructive text-center",children:V})]}),e.jsx("div",{className:"mt-6 text-center text-sm text-muted-foreground",children:e.jsx("p",{children:"Ingresa con una cuenta autorizada."})})]})]})})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(D,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-primary",children:"Panel de Administración"}),e.jsx("p",{className:"text-muted-foreground",children:"Gestión de inscripciones - Los Naranjos 2025"})]}),e.jsx(o,{variant:"outline",onClick:le,children:"Cerrar Sesión"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-6 mb-8",children:[e.jsx(i,{className:"card-gradient shadow-card",children:e.jsxs(m,{className:"text-center pb-3",children:[e.jsx(x,{className:"text-2xl text-primary",children:j.total}),e.jsx(u,{children:"Total Inscritos"})]})}),e.jsx(i,{className:"card-gradient shadow-card",children:e.jsxs(m,{className:"text-center pb-3",children:[e.jsx(x,{className:"text-2xl text-warm-accent",children:j.pending}),e.jsx(u,{children:"Pendientes"})]})}),e.jsx(i,{className:"card-gradient shadow-card",children:e.jsxs(m,{className:"text-center pb-3",children:[e.jsx(x,{className:"text-2xl text-lake-green",children:j.validated}),e.jsx(u,{children:"Validados"})]})}),e.jsx(i,{className:"card-gradient shadow-card",children:e.jsxs(m,{className:"text-center pb-3",children:[e.jsx(x,{className:"text-2xl text-secondary",children:j.checkedIn}),e.jsx(u,{children:"Check-in"})]})}),e.jsx(i,{className:"card-gradient shadow-card",children:e.jsxs(m,{className:"text-center pb-3",children:[e.jsx(x,{className:"text-2xl text-destructive",children:j.rejected}),e.jsx(u,{children:"Rechazados"})]})}),e.jsx(i,{className:"card-gradient shadow-card",children:e.jsxs(m,{className:"text-center pb-3",children:[e.jsx(x,{className:"text-2xl text-primary",children:j.remaining}),e.jsx(u,{children:"Cupos Restantes"})]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-8",children:[e.jsxs(o,{className:"button-gradient shadow-button",onClick:he,children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Exportar CSV"]}),e.jsxs(o,{variant:"outline",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Lector QR"]}),e.jsxs(o,{variant:"outline",children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Check-in"]})]}),e.jsxs(i,{className:"card-gradient shadow-card mb-8",children:[e.jsx(m,{children:e.jsx(x,{className:"text-xl text-primary",children:"Filtros y Búsqueda"})}),e.jsxs(z,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(S,{className:"pl-10",placeholder:"DNI, nombre, referencia...",value:R,onChange:s=>ee(s.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Estado"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-border rounded-md bg-background",value:w,onChange:s=>se(s.target.value),children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"pending",children:"Pendientes"}),e.jsx("option",{value:"validated",children:"Validados"}),e.jsx("option",{value:"rejected",children:"Rechazados"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Distancia"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-border rounded-md bg-background",value:C,onChange:s=>ae(s.target.value),children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"800m",children:"800m"}),e.jsx("option",{value:"2km",children:"2km"}),e.jsx("option",{value:"5km",children:"5km"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Categoría"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-border rounded-md bg-background",value:k,onChange:s=>te(s.target.value),children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"Infantiles A (9-10)",children:"Infantiles A (9-10)"}),e.jsx("option",{value:"Infantiles B (11-12)",children:"Infantiles B (11-12)"}),e.jsx("option",{value:"Juveniles A (13-14)",children:"Juveniles A (13-14)"}),e.jsx("option",{value:"Juveniles B (15-17)",children:"Juveniles B (15-17)"}),e.jsx("option",{value:"20-30",children:"20-30"}),e.jsx("option",{value:"30-40",children:"30-40"}),e.jsx("option",{value:"40+",children:"40+"}),e.jsx("option",{value:"Masters",children:"Masters"})]})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-4",children:["Registra tiempos en formato ",e.jsx("strong",{children:"mm:ss"})," o ",e.jsx("strong",{children:"hh:mm:ss"}),". También puedes usar los códigos",e.jsx("strong",{children:" NT"})," (No Time) y ",e.jsx("strong",{children:"NS"})," (No Show) cuando corresponda."]})]})]}),e.jsxs(i,{className:"card-gradient shadow-card",children:[e.jsx(m,{children:e.jsx(x,{className:"text-xl text-primary",children:"Inscripciones"})}),e.jsx(z,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm md:text-base",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-left py-4 px-3",children:"Fecha"}),e.jsx("th",{className:"text-left py-4 px-3",children:"Dorsal"}),e.jsx("th",{className:"text-left py-4 px-3",children:"Nombre"}),e.jsx("th",{className:"text-left py-4 px-3",children:"DNI"}),e.jsx("th",{className:"text-left py-4 px-3",children:"Distancia"}),e.jsx("th",{className:"text-left py-4 px-3",children:"Categoría"}),e.jsx("th",{className:"text-left py-4 px-3",children:"Tiempo"}),e.jsx("th",{className:"text-left py-4 px-3",children:"Talla"}),e.jsx("th",{className:"text-left py-4 px-3",children:"Banco"}),e.jsx("th",{className:"text-left py-4 px-3",children:"Monto"}),e.jsx("th",{className:"text-left py-4 px-3",children:"Referencia"}),e.jsx("th",{className:"text-left py-4 px-3",children:"Check-in"}),e.jsx("th",{className:"text-left py-4 px-3",children:"Estado"}),e.jsx("th",{className:"text-left py-4 px-3",children:"Acciones"})]})}),e.jsx("tbody",{children:Y?e.jsx("tr",{children:e.jsx("td",{className:"py-6 text-center text-muted-foreground",colSpan:14,children:"Cargando inscripciones..."})}):F?e.jsx("tr",{children:e.jsx("td",{className:"py-6 text-center text-destructive",colSpan:14,children:F})}):J.length===0?e.jsx("tr",{children:e.jsx("td",{className:"py-6 text-center text-muted-foreground",colSpan:14,children:"No hay inscripciones que coincidan con los filtros seleccionados."})}):J.map(s=>e.jsxs("tr",{className:"border-b border-border hover:bg-muted/30",children:[e.jsx("td",{className:"py-4 px-3",children:_(s.createdAt)}),e.jsxs("td",{className:"py-4 px-3 font-mono whitespace-nowrap",children:["#",s.dorsal]}),e.jsx("td",{className:"py-4 px-3 font-medium whitespace-normal",children:s.nombre}),e.jsx("td",{className:"py-4 px-3 font-mono text-xs md:text-sm whitespace-nowrap",children:s.dni}),e.jsx("td",{className:"py-4 px-3",children:s.distancia}),e.jsx("td",{className:"py-4 px-3",children:s.categoria||"N/A"}),e.jsx("td",{className:"py-4 px-3 min-w-[220px]",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{value:ce(s),onChange:a=>de(s.id,a.target.value),placeholder:"mm:ss o NT/NS",className:"h-9"}),e.jsxs(o,{type:"button",size:"sm",className:"flex items-center gap-1",disabled:ne[s.id],onClick:()=>oe(s),children:[e.jsx(be,{className:"h-4 w-4"}),"Guardar"]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-2",children:[s.resultTime?e.jsxs("span",{className:"flex items-center gap-1 text-primary",children:[e.jsx(ye,{className:"h-3 w-3"}),s.resultTime]}):e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"h-3 w-3"}),"Pendiente"]}),s.resultRecordedAt&&e.jsxs("span",{children:["· ",new Date(s.resultRecordedAt).toLocaleString("es-HN")]})]})]})}),e.jsx("td",{className:"py-4 px-3",children:s.tallaCamisa||"N/A"}),e.jsx("td",{className:"py-4 px-3",children:s.banco||"N/A"}),e.jsx("td",{className:"py-4 px-3",children:s.monto?`L ${s.monto}`:"N/A"}),e.jsx("td",{className:"py-4 px-3 font-mono text-xs md:text-sm whitespace-nowrap",children:s.referencia||"N/A"}),e.jsx("td",{className:"py-4 px-3",children:s.checkedInAt?_(s.checkedInAt):"Pendiente"}),e.jsx("td",{className:"py-4 px-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.status==="validated"?"bg-lake-green/20 text-lake-green":s.status==="pending"?"bg-warm-accent/20 text-warm-accent":"bg-destructive/20 text-destructive"}`,children:s.status==="validated"?"Validado":s.status==="pending"?"Pendiente":"Rechazado"})}),e.jsx("td",{className:"py-4 px-3",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(o,{size:"sm",variant:"outline",onClick:()=>ie(s),children:"Ver"}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>me(s),disabled:!s.comprobanteUrl,children:"Comprobante"}),e.jsx(o,{size:"sm",variant:"outline",className:s.checkedInAt?"bg-lake-green/10 text-lake-green":"",onClick:()=>xe(s),disabled:s.status==="rejected"||s.status==="pending"&&!s.checkedInAt,children:s.checkedInAt?"Revertir":"Check-in"}),s.status==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(o,{size:"sm",variant:"outline",className:"text-lake-green",onClick:()=>L(s.id,"validated"),children:"✓"}),e.jsx(o,{size:"sm",variant:"outline",className:"text-destructive",onClick:()=>L(s.id,"rejected"),children:"✗"})]}):e.jsx(o,{size:"sm",variant:"outline",onClick:()=>L(s.id,"pending"),children:"Pend."})]})})]},s.id))})]})})})]})]})]})};export{Fe as default};
