import{r as l,j as e,S as te,N as re,J as ne,O as le,U as ce,P as de}from"./vendor-CXadzovC.js";import{N as A,C as d,a as o,b as i,c as x,d as L,B as c}from"./card-D9joW9dy.js";import{L as j,I as D}from"./label-DBJfa2Ch.js";import{a as oe,u as ie}from"./index-BCF1eixx.js";import{j as me,k as xe,l as w,F as he,m as U}from"./firebase-DUZ5dv6p.js";import"./radix-C1F2jKhp.js";const be=()=>{const{toast:n}=oe(),{registrations:g,stats:u,updateRegistrationStatus:V,toggleCheckIn:q,isLoading:M,error:R}=ie(),C=l.useMemo(()=>"gustavomartinezh87@gmail.com".split(",").map(s=>s.trim().toLowerCase()).filter(Boolean),[]),[N,T]=l.useState({email:"",password:""}),[z,k]=l.useState(null),[v,I]=l.useState(null),[O,J]=l.useState(!0),[F,B]=l.useState(!1),[S,H]=l.useState(""),[p,Q]=l.useState(""),[b,G]=l.useState(""),[f,W]=l.useState(""),_=async s=>{s.preventDefault(),B(!0),k(null);try{const a=N.email.trim().toLowerCase();if(!C.includes(a))throw new Error("Este correo no está autorizado para acceder al panel.");await xe(w,a,N.password),n({title:"Acceso autorizado",description:"Bienvenido al panel de administración"})}catch(a){let r="No se pudo autenticar. Intenta nuevamente.";if(a instanceof he)switch(a.code){case"auth/invalid-credential":case"auth/wrong-password":r="Contraseña incorrecta.";break;case"auth/user-not-found":r="No existe un usuario con ese correo.";break;case"auth/too-many-requests":r="Demasiados intentos. Espera unos minutos antes de volver a intentar.";break;default:r=a.message}else a instanceof Error&&(r=a.message);k(r),n({variant:"destructive",title:"Error",description:r})}finally{B(!1)}};l.useEffect(()=>{const s=me(w,async a=>{var r;if(k(null),a){const m=((r=a.email)==null?void 0:r.toLowerCase())??"";C.includes(m)?I(a):(await U(w),I(null),n({variant:"destructive",title:"Acceso denegado",description:"Tu cuenta no tiene permiso para acceder al panel de administración."}))}else I(null);J(!1)});return()=>s()},[C,n]);const K=(v==null?void 0:v.email)??"",X=async()=>{try{await U(w),n({title:"Sesión cerrada",description:"Has salido del panel de administración."})}catch{n({variant:"destructive",title:"Error",description:"No se pudo cerrar la sesión. Intenta nuevamente."})}},P=l.useMemo(()=>{const s=S.trim().toLowerCase();return g.filter(a=>{const r=!s||[a.nombre,a.dni,a.email,a.telefono,a.referencia,a.dorsal].map(t=>String(t||"").toLowerCase()).some(t=>t.includes(s)),m=!p||a.status===p,y=!b||a.distancia===b,h=!f||a.categoria===f;return r&&m&&y&&h}).sort((a,r)=>new Date(r.createdAt).getTime()-new Date(a.createdAt).getTime())},[g,S,p,b,f]),$=s=>{const a=new Date(s);return Number.isNaN(a.getTime())?s:a.toLocaleString("es-HN",{dateStyle:"medium",timeStyle:"short"})},E=async(s,a)=>{const r={validated:{title:"Inscripción validada",description:"El participante aparece ahora como validado en el panel."},rejected:{title:"Inscripción rechazada",description:"Recuerda comunicar al participante el motivo del rechazo."},pending:{title:"Inscripción pendiente",description:"El registro volvió al estado pendiente para revisión."}};try{await V(s,a,a==="pending"?{checkedInAt:null,checkedInBy:null}:{}),n(r[a])}catch(m){console.error("Error al actualizar estado",m),n({variant:"destructive",title:"Error",description:"No se pudo actualizar el estado. Intenta nuevamente."})}},Y=s=>{n({title:s.nombre,description:`DNI: ${s.dni} | Email: ${s.email} | Tel: ${s.telefono||"No indicado"} | Talla: ${s.tallaCamisa||"No indicada"} | Comprobante: ${s.comprobanteNombre??"No adjuntado"}`})},Z=s=>{if(!s.comprobanteUrl){n({variant:"destructive",title:"Sin comprobante",description:"Este registro no tiene un comprobante adjunto."});return}window.open(s.comprobanteUrl,"_blank","noopener,noreferrer")},ee=async s=>{try{const a=!s.checkedInAt;await q(s.id,a,K||"admin@losnaranjos.com"),n({title:a?"Check-in registrado":"Check-in revertido",description:a?`El participante ${s.nombre} quedó marcado como presente.`:`El check-in de ${s.nombre} fue revertido.`})}catch(a){console.error("Error al registrar check-in",a),n({variant:"destructive",title:"Error",description:"No se pudo registrar el check-in. Intenta nuevamente."})}},se=()=>{if(!g.length){n({title:"Sin datos",description:"Aún no hay inscripciones para exportar."});return}const s=["Dorsal","Nombre","DNI","Email","Teléfono","Distancia","Categoría","Talla","Banco","Monto","Referencia","Estado","Check-in","Check-in por","Fecha registro"],a=g.map(t=>[t.dorsal,t.nombre,t.dni,t.email,t.telefono,t.distancia,t.categoria,t.tallaCamisa,t.banco,t.monto,t.referencia,t.status,t.checkedInAt?t.checkedInAt:"",t.checkedInBy??"",t.createdAt]),r=[s,...a].map(t=>t.map(ae=>`"${String(ae??"").replace(/"/g,'""')}"`).join(",")).join(`
`),m=new Blob([r],{type:"text/csv;charset=utf-8;"}),y=URL.createObjectURL(m),h=document.createElement("a");h.href=y,h.download=`inscripciones-${new Date().toISOString()}.csv`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(y),n({title:"Exportación lista",description:"El archivo CSV se descargó correctamente."})};return O?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(A,{}),e.jsx("div",{className:"flex items-center justify-center px-4 py-32",children:e.jsx(d,{className:"card-gradient shadow-card max-w-sm w-full",children:e.jsxs(o,{className:"text-center",children:[e.jsx(i,{className:"text-xl",children:"Cargando autenticación..."}),e.jsx(x,{children:"Por favor espera un momento."})]})})})]}):v?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(A,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-primary",children:"Panel de Administración"}),e.jsx("p",{className:"text-muted-foreground",children:"Gestión de inscripciones - Los Naranjos 2025"})]}),e.jsx(c,{variant:"outline",onClick:X,children:"Cerrar Sesión"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-6 mb-8",children:[e.jsx(d,{className:"card-gradient shadow-card",children:e.jsxs(o,{className:"text-center pb-3",children:[e.jsx(i,{className:"text-2xl text-primary",children:u.total}),e.jsx(x,{children:"Total Inscritos"})]})}),e.jsx(d,{className:"card-gradient shadow-card",children:e.jsxs(o,{className:"text-center pb-3",children:[e.jsx(i,{className:"text-2xl text-warm-accent",children:u.pending}),e.jsx(x,{children:"Pendientes"})]})}),e.jsx(d,{className:"card-gradient shadow-card",children:e.jsxs(o,{className:"text-center pb-3",children:[e.jsx(i,{className:"text-2xl text-lake-green",children:u.validated}),e.jsx(x,{children:"Validados"})]})}),e.jsx(d,{className:"card-gradient shadow-card",children:e.jsxs(o,{className:"text-center pb-3",children:[e.jsx(i,{className:"text-2xl text-secondary",children:u.checkedIn}),e.jsx(x,{children:"Check-in"})]})}),e.jsx(d,{className:"card-gradient shadow-card",children:e.jsxs(o,{className:"text-center pb-3",children:[e.jsx(i,{className:"text-2xl text-destructive",children:u.rejected}),e.jsx(x,{children:"Rechazados"})]})}),e.jsx(d,{className:"card-gradient shadow-card",children:e.jsxs(o,{className:"text-center pb-3",children:[e.jsx(i,{className:"text-2xl text-primary",children:u.remaining}),e.jsx(x,{children:"Cupos Restantes"})]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-8",children:[e.jsxs(c,{className:"button-gradient shadow-button",onClick:se,children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Exportar CSV"]}),e.jsxs(c,{variant:"outline",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Lector QR"]}),e.jsxs(c,{variant:"outline",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Check-in"]})]}),e.jsxs(d,{className:"card-gradient shadow-card mb-8",children:[e.jsx(o,{children:e.jsx(i,{className:"text-xl text-primary",children:"Filtros y Búsqueda"})}),e.jsx(L,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(D,{className:"pl-10",placeholder:"DNI, nombre, referencia...",value:S,onChange:s=>H(s.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Estado"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-border rounded-md bg-background",value:p,onChange:s=>Q(s.target.value),children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"pending",children:"Pendientes"}),e.jsx("option",{value:"validated",children:"Validados"}),e.jsx("option",{value:"rejected",children:"Rechazados"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Distancia"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-border rounded-md bg-background",value:b,onChange:s=>G(s.target.value),children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"800m",children:"800m"}),e.jsx("option",{value:"2km",children:"2km"}),e.jsx("option",{value:"5km",children:"5km"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Categoría"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-border rounded-md bg-background",value:f,onChange:s=>W(s.target.value),children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"Infantiles B (11-12)",children:"Infantiles B (11-12)"}),e.jsx("option",{value:"Juveniles A (13-14)",children:"Juveniles A (13-14)"}),e.jsx("option",{value:"Juveniles B (15-17)",children:"Juveniles B (15-17)"}),e.jsx("option",{value:"20-30",children:"20-30"}),e.jsx("option",{value:"30-40",children:"30-40"}),e.jsx("option",{value:"40+",children:"40+"}),e.jsx("option",{value:"Masters",children:"Masters"})]})]})]})})]}),e.jsxs(d,{className:"card-gradient shadow-card",children:[e.jsx(o,{children:e.jsx(i,{className:"text-xl text-primary",children:"Inscripciones"})}),e.jsx(L,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-left py-3 px-2",children:"Fecha"}),e.jsx("th",{className:"text-left py-3 px-2",children:"Dorsal"}),e.jsx("th",{className:"text-left py-3 px-2",children:"Nombre"}),e.jsx("th",{className:"text-left py-3 px-2",children:"DNI"}),e.jsx("th",{className:"text-left py-3 px-2",children:"Distancia"}),e.jsx("th",{className:"text-left py-3 px-2",children:"Categoría"}),e.jsx("th",{className:"text-left py-3 px-2",children:"Talla"}),e.jsx("th",{className:"text-left py-3 px-2",children:"Banco"}),e.jsx("th",{className:"text-left py-3 px-2",children:"Monto"}),e.jsx("th",{className:"text-left py-3 px-2",children:"Referencia"}),e.jsx("th",{className:"text-left py-3 px-2",children:"Check-in"}),e.jsx("th",{className:"text-left py-3 px-2",children:"Estado"}),e.jsx("th",{className:"text-left py-3 px-2",children:"Acciones"})]})}),e.jsx("tbody",{children:M?e.jsx("tr",{children:e.jsx("td",{className:"py-6 text-center text-muted-foreground",colSpan:13,children:"Cargando inscripciones..."})}):R?e.jsx("tr",{children:e.jsx("td",{className:"py-6 text-center text-destructive",colSpan:13,children:R})}):P.length===0?e.jsx("tr",{children:e.jsx("td",{className:"py-6 text-center text-muted-foreground",colSpan:13,children:"No hay inscripciones que coincidan con los filtros seleccionados."})}):P.map(s=>e.jsxs("tr",{className:"border-b border-border hover:bg-muted/30",children:[e.jsx("td",{className:"py-3 px-2",children:$(s.createdAt)}),e.jsxs("td",{className:"py-3 px-2 font-mono",children:["#",s.dorsal]}),e.jsx("td",{className:"py-3 px-2 font-medium",children:s.nombre}),e.jsx("td",{className:"py-3 px-2 font-mono text-sm",children:s.dni}),e.jsx("td",{className:"py-3 px-2",children:s.distancia}),e.jsx("td",{className:"py-3 px-2",children:s.categoria||"N/A"}),e.jsx("td",{className:"py-3 px-2",children:s.tallaCamisa||"N/A"}),e.jsx("td",{className:"py-3 px-2",children:s.banco||"N/A"}),e.jsx("td",{className:"py-3 px-2",children:s.monto?`L ${s.monto}`:"N/A"}),e.jsx("td",{className:"py-3 px-2 font-mono text-sm",children:s.referencia||"N/A"}),e.jsx("td",{className:"py-3 px-2",children:s.checkedInAt?$(s.checkedInAt):"Pendiente"}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.status==="validated"?"bg-lake-green/20 text-lake-green":s.status==="pending"?"bg-warm-accent/20 text-warm-accent":"bg-destructive/20 text-destructive"}`,children:s.status==="validated"?"Validado":s.status==="pending"?"Pendiente":"Rechazado"})}),e.jsx("td",{className:"py-3 px-2",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>Y(s),children:"Ver"}),e.jsx(c,{size:"sm",variant:"outline",onClick:()=>Z(s),disabled:!s.comprobanteUrl,children:"Comprobante"}),e.jsx(c,{size:"sm",variant:"outline",className:s.checkedInAt?"bg-lake-green/10 text-lake-green":"",onClick:()=>ee(s),disabled:s.status==="rejected"||s.status==="pending"&&!s.checkedInAt,children:s.checkedInAt?"Revertir":"Check-in"}),s.status==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(c,{size:"sm",variant:"outline",className:"text-lake-green",onClick:()=>E(s.id,"validated"),children:"✓"}),e.jsx(c,{size:"sm",variant:"outline",className:"text-destructive",onClick:()=>E(s.id,"rejected"),children:"✗"})]}):e.jsx(c,{size:"sm",variant:"outline",onClick:()=>E(s.id,"pending"),children:"Pend."})]})})]},s.id))})]})})})]})]})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(A,{}),e.jsx("div",{className:"max-w-md mx-auto px-4 py-16",children:e.jsxs(d,{className:"card-gradient shadow-card",children:[e.jsxs(o,{className:"text-center",children:[e.jsx(te,{className:"h-16 w-16 text-primary mx-auto mb-4"}),e.jsx(i,{className:"text-2xl",children:"Acceso Restringido"}),e.jsx(x,{children:"Panel de administración del Encuentro de Aguas Abiertas Los Naranjos"})]}),e.jsxs(L,{children:[e.jsxs("form",{onSubmit:_,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"email",children:"Email"}),e.jsx(D,{id:"email",type:"email",value:N.email,onChange:s=>T(a=>({...a,email:s.target.value})),required:!0,placeholder:"admin@losnaranjos.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"password",children:"Contraseña"}),e.jsx(D,{id:"password",type:"password",value:N.password,onChange:s=>T(a=>({...a,password:s.target.value})),required:!0,placeholder:"••••••••"})]}),e.jsx(c,{type:"submit",className:"w-full button-gradient shadow-button",disabled:F,children:F?e.jsx(e.Fragment,{children:"Verificando..."}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Iniciar Sesión"]})}),z&&e.jsx("p",{className:"text-sm text-destructive text-center",children:z})]}),e.jsx("div",{className:"mt-6 text-center text-sm text-muted-foreground",children:e.jsx("p",{children:"Ingresa con una cuenta autorizada."})})]})]})})]})};export{be as default};
